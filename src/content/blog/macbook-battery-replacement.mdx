---
title: "How I Optimized My Way to a Free MacBook Battery Replacement"
publishDate: 2026-02-08
description: "How I used IOKit and the SMC to get a free battery replacement before my AppleCare expired"
tags: ["hardware", "optimization", "Apple"]
wip: true
---

import { Image } from 'astro:assets';
import batteryImage from '@/assets/optimize-macbook-battery_rgba.png';

<Image src={batteryImage} alt="MacBook battery optimization" class="mx-auto my-4" style="max-width: 400px;" width={400} />

My AppleCare Plus was about to expire and my battery health was at 81%. Apple replaces your battery for free if it drops to 79% or below. Two percent off, weeks to go. I wasn't going to eat a $199 replacement over that.

So I wrote a small program that talks to the System Management Controller (SMC) through IOKit, figured out how the charge cycle tracking actually works, and ran enough cycles to push the health reading down before my coverage lapsed.

## Reading battery data with IOKit

Before doing anything, I needed to see the actual numbers. macOS exposes battery stats through the `AppleSmartBattery` IOService, which you can query with IOKit. Cycle count, max capacity, design capacity, all of it is in there.

```c
#include <IOKit/IOKitLib.h>
#include <stdio.h>

int main(void) {
    io_service_t service = IOServiceGetMatchingService(
        kIOMainPortDefault,
        IOServiceMatching("AppleSmartBattery")
    );

    CFMutableDictionaryRef props = NULL;
    IORegistryEntryCreateCFProperties(service, &props, kCFAllocatorDefault, 0);

    int cycles;
    CFNumberRef val = CFDictionaryGetValue(props, CFSTR("CycleCount"));
    CFNumberGetValue(val, kCFNumberIntType, &cycles);
    printf("Cycle Count: %d\n", cycles);

    CFRelease(props);
    IOObjectRelease(service);
    return 0;
}
```
