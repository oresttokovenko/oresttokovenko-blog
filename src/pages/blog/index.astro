---
import { getCollection } from "astro:content";
import { SITE_TITLE } from "../../consts";
import Layout from "../../layouts/Layout.astro";

// Get all blog posts and sort by publish date
const posts = await getCollection("blog");
const sortedPosts = posts.sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
);
---

<Layout title={`${SITE_TITLE} | Blog`}>
  <div style="background-color: rgb(238, 230, 210);">
    <div class="mx-auto max-w-7xl px-4 py-10 sm:px-6 md:py-16 lg:px-8">
      <div class="mb-12 text-center">
        <h1
          class="font-spectral text-4xl font-bold tracking-tight text-gray-900 md:text-5xl"
        >
          Archive
        </h1>
      </div>

      <div class="mx-auto max-w-4xl">
        {
          sortedPosts.map((post, index) => (
            <article
              class={`py-8 ${index !== sortedPosts.length - 1 ? "border-b border-gray-400" : ""}`}
            >
              <a href={`/blog/${post.id}`} class="group block">
                <div class="flex flex-col md:flex-row md:items-start md:gap-8">
                  <time
                    datetime={post.data.publishDate.toISOString()}
                    class="font-ibm mb-3 flex-shrink-0 text-sm text-gray-600 md:mb-0 md:w-32"
                  >
                    {post.data.publishDate.toLocaleDateString("en-US", {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    })}
                  </time>

                  <div class="flex-1">
                    <h2 class="font-spectral mb-2 text-xl font-bold text-gray-900 transition-colors group-hover:text-gray-700 md:text-2xl">
                      {post.data.title}
                    </h2>

                    {post.data.description && (
                      <p class="font-spectral mb-3 text-sm leading-relaxed text-gray-700">
                        {post.data.description}
                      </p>
                    )}

                    {post.data.tags && post.data.tags.length > 0 && (
                      <div class="flex flex-wrap gap-2">
                        {post.data.tags.map((tag) => (
                          <span
                            class="font-ibm px-2 py-1 text-xs font-medium text-white"
                            style="background-color: rgb(22, 31, 116);"
                          >
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </a>
            </article>
          ))
        }
      </div>
    </div>
  </div>
</Layout>
